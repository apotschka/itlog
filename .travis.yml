# Travis CI script
# This is a skeleton created by zproject.
# You can add hand-written code here.

language: c

cache: ccache

os:
- linux

sudo: false

services:
- docker

# Set CI_TIME=true to enable build-step profiling in Travis
# Set CI_TRACE=true to enable shell script tracing in Travis
# Set CI_CONFIG_QUIET=true to enable "configure --quiet" (only report stderr)
env:
  global:
    - CI_TIME=false
    - CI_TRACE=false
    - CI_QUIET=true
  matrix:
    - BUILD_TYPE=default
    - BUILD_TYPE=default-Werror
    - BUILD_TYPE=cmake
#   - BUILD_TYPE=android
#   - BUILD_TYPE=check-py

matrix:
  include:
  - env: BUILD_TYPE=valgrind
    os: linux
    dist: trusty
    sudo: required
    addons:
      apt:
        packages:
        - valgrind

addons:
  sources:
  - sourceline: 'deb http://download.opensuse.org/repositories/home:/zeromq:/git-draft/xUbuntu_12.04/ ./'
    key_url: 'http://download.opensuse.org/repositories/home:/zeromq:/git-draft/xUbuntu_12.04/Release.key'
  apt:
    packages:
    - asciidoc
    - xmlto

before_install:
- if [ $TRAVIS_OS_NAME == "osx" ] ; then brew update; brew install binutils valgrind ; fi

# Hand off to generated script for each BUILD_TYPE
script: ./ci_build.sh
before_deploy: . ./ci_deploy.sh
deploy:
  provider: releases
  api_key:
    # To encrypt your access token run: `travis encrypt -r user/repo`
    secure: "UXX12sbwE/qrlDg6j2L4ejyHCO3/21gDqym4hkv/5Bjfx2aYIq/17l08St0GQZYEPRSA2NAZDhygYnq5H8PpJdSuLL5tWxI8O61HkuXf/aBNscHHuTUVpTk2i9cqEZ4Cghre45H2WTSzWFXpDMp8Kr1dl/pKBhqohsVPI0tFn6VunbHX9n3e+JFGbbmLq+BGsfF3aXEFgZtEeXjmp6MiSjqeruRExq3tBcWu5UION4Nhas0U4iRL9aG4rHoFf3A7F4hSAPjVKa5Ib7lntTVdwq4c8hl8j+Vh0/wreBi+2Y+X5NilFkQJCFvzwsFNES7Vv/KERR6hPVqP3eeyobx3hD5J5L9sUWXDTkCTVCW2s4yszbRudvedq2YxeTpLj6lZLE8fbB+Zz9bl2+UB51TdFzga9YHgxLDB7Fd3MSJtihUgSfuuumfYRG/1wwdFkJhWIQR95/O+5kKdaflOewfA2JFxB63/CBAsEqMlliJkfMrq9L0NZNTrn+t8BlfMKegVytuzhDtFxm4IQlP0Vfkl8cfU6uwbFb5iFqj4wpeGZ7WD6cGnUYUEHHGgvDVDO2852GUpCzIK5I4m4F1D2anJWyuKFCa59XZF8EKZ44Fr5rWbOpR2iNNf9BdAc0EWFAKaqoWD6gVzq24MZutyb7CO6h1ogwhjez5YigGfUDKCbNM="
  file_glob: true
  file: ${ITLOG_DEPLOYMENT}
  skip_cleanup: true
  on:
    branch: master
    tags: true
    condition: $TRAVIS_OS_NAME =~ (linux) && $BUILD_TYPE =~ (default)
